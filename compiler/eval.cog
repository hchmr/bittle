include "cog.cogs";

func const_eval(e: *Expr): Int {
    if (str_eq(e.kind, "<int>")) {
        return e.int_val;
    } else if (str_eq(e.kind, "-_")) {
        return -const_eval(e.children[0]);
    } else if (str_eq(e.kind, "_+_")) {
        return const_eval(e.children[0]) + const_eval(e.children[1]);
    } else if (str_eq(e.kind, "_-_")) {
        return const_eval(e.children[0]) - const_eval(e.children[1]);
    } else {
        error_at(&e.pos);
        fprintf(stderr, "Failed to evaluate constant expression.\n", e.kind);
        exit(1);
    }
}
